# 学习笔记

## C语言常用的函数：

#### ==`strcpy`==

  **C 语言中的一个字符串函数，用于将一个字符串复制到另一个字符串中。它的函数原型如下：**

```c
char *strcpy(char *dest, const char *src);
```

**其中，`dest` 是目标字符串的指针，`src` 是源字符串的指针。`strcpy` 函数将源字符串中的字符复制到目标字符串中，直到遇到源字符串中的空字符 `\0` 为止，并将目标字符串的末尾设置为 `\0`。**

**例如，下面的代码将字符串 `"hello"` 复制到字符串 `str` 中：**

```c
char str[6];
strcpy(str, "hello");

```

**需要注意的是，`strcpy` 函数没有对目标字符串的长度进行检查，如果目标字符串的空间不足以存储源字符串，可能会导致缓冲区溢出的问题。因此，在使用 `strcpy` 函数时，需要确保目标字符串有足够的空间来存储源字符串，或者使用更安全的字符串函数，如 `strncpy` 或 `strcpy_s`。**

## 回调函数的使用

### 首先，确定好自己的回调函数的定义

```c
typedef void (*User_cb_t)(int num,int time);
```

### 其次，注册回调函数

```cpp
typedef struct
{
   User_cb_t cb_t;
} lv_user_data_t;
```

### 在你需要用到的地方注册结构体回调以及定义函数

```c
static const lv_user_data_t Print_user_data_t = {
    .obj = NULL,
    .cb_t = XXXX,(你自己需要的回调函数：typedef void (*User_cb_t)(int num,int time);)
比如：static void Print_user_data(int num,int time){}
};
void User_time_print( const lv_user_data_t*cb_t,int pop);{
在你需要用到回调的地方
cb_t->cb_t(int num=5,int time=8);
}
```

调用

```c
User_time_print( &Print_user_data_t ,10);
//User_time_print( &Print_keyboard_user_data_t,与形参对应类型);
```

## 队列循环发送

### 命令发送字符串队列结构体

```c
typedef struct
{
    String queue[QUEUE_LEN];//字符串
    uint8_t index_r; // 环形缓冲区读取位置
    uint8_t index_w; // 环形缓冲区写位置
    uint8_t count;   // 命令队列中的命令数量
} post_queue_t;
```

应用

```cpp
    post_queue.queue[post_queue.index_w] = path;
    post_queue.index_w = (post_queue.index_w + 1) % QUEUE_LEN;
    post_queue.count++;//表示一个添加一个命令 然后指向下一个
```

```cpp
    Response = send_request("POST", post_queue.queue[post_queue.index_r]);
    post_queue.count--;
    post_queue.index_r = (post_queue.index_r + 1) % QUEUE_LEN;//发送命令 然后循环发送
```

# ESP32

## Freertos事件通知

wifi为例子：

```c
#define WIFI_CONNECTED_BIT (1 << 0) // 00000001
#define WIFI_FAIL_BIT (1 << 1)      // 00000010

static EventGroupHandle_t s_wifi_event_group;
s_wifi_event_group = xEventGroupCreate();//创建事件组

//发生某个事件，置位事件组
xEventGroupSetBits(s_wifi_event_group, WIFI_FAIL_BIT);

//主循环去判断是否得到了响应标志位
EventBits_t fail_bits = xEventGroupWaitBits(s_wifi_event_group, WIFI_FAIL_BIT, pdTRUE, pdTRUE, portMAX_DELAY);
 if (fail_bits & WIFI_FAIL_BIT)
 {
  	WIFI_SETUP("wifi断开连接");
 }
	
```

可用于其他任务标志位的获取（只能单个标志位，不能获取多个，用作通知可以）

# 多语言实现

## Git拉取代码工程

<https://github.com/PoohWoah/ESP_Develop_Engineer.git>

## **移植resource\_manage文件夹到自己的目录**

#### **使用powershell进入lv\_i18n目录** 
E:\chenqiang\project\backup\lvgl_design\main\resource_manage\lv_i18n
npx tool/node_modules/lv_i18n compile -t translations/*.yml -o .

使用前参考以下步骤先安装lvgl的lv_i18n
npm init private
npm i lv_i18n -s

npx github:littlevgl/lv_i18n -h

npx lv_i18n -h
将所有module安装在本地

npx lv_i18n compile -t translations/*.yml -o src/lv_i18n
不需要双引号

lv_i18n> npx tool/node_modules/lv_i18n compile -t translations/*.yml -o .

#### 注意事项

zh-cn:\
\#SETTING PAGE\
setting\_gen\_t: '通用'\
\
en-GB: \
\#SETTING PAGE\
setting\_gen\_t: 'General'\
\
lv\_i18n工具会把定义的yml词条转换成c数组\
setting\_gen\_t通过js脚本转换成大写K\_SETTING\_GEN\_T\
\
static const lv\_i18n\_phrase\_t en\_gb\_singulars\[] = {\
{K\_SETTING\_GEN\_T, "General"},\
\
通过K\_SETTING\_GEN\_T找到"General"和'通用'

**至此，lv_i18n多语言调用切换就实现了（结合代码）**


## 外部字库的添加

进入项目C:\Users\82030\Desktop\my_project\k-touch_724\main\resource_manage\tools
<img src=img/Font_exct1.png width="600"/>
    ① ：生成需要添加的外部字库的bin文件
    ② ：生成更新时所需的文件
    ③ ：外部字库生成工具，图标字库同步lvgl
    ④ ：需要的字体
    ⑤ ：字符集
    ⑥ ：文件合并工具
    ⑦ ：文字转化工具

### 生成需要的字体的bin文件
C:\Users\82030\Desktop\my_project\k-touch_724\main\resource_manage\tools\font_bin
<img src=img/1.png width="600"/>
### 合并
C:\Users\82030\Desktop\my_project\k-touch_724\main\resource_manage\tools\generate_img\once\inputfiles\font_other
<img src=img/2.png width="600"/>

### 将自己需要的外部图片放在
C:\Users\82030\Desktop\my_project\k-touch_724\main\resource_manage\tools\generate_img\once\spiffs_pictures
<img src=img/3.png width="600"/>

### 生成img文件烧录镜像
cd main/resource_manage/tools/generate_img/once/

生成指令python3 build_image.py build-img --path inputfiles
<img src=img/4.png width="600"/>

### WSL连接USB存储设备
https://blog.csdn.net/m0_46228204/article/details/134452325?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522171427796216800211571307%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=171427796216800211571307&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-1-134452325-null-null.142^v100^pc_search_result_base5&utm_term=wls2&spm=1018.2226.3001.4187

https://zhuanlan.zhihu.com/p/661175117



### 生成后的文件txt
C:\Users\82030\Desktop\my_project\k-touch_724\main\resource_manage\tools\generate_img\once\inputfiles
<img src=img/5.png width="600"/>
复制到代码里面
C:\Users\82030\Desktop\lvgl_design-k-touch_2024_7_16\main\resource_manage\lib\utils_lib.c
C:\Users\82030\Desktop\lvgl_design-k-touch_2024_7_16\main\resource_manage\lib\utils_lib.h
###

